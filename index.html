<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯</title>
  <link rel="stylesheet" href="style.css">

  <!-- âœ… Ù…ÙƒØªØ¨Ø© EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

  <!-- âœ… Ù…ÙƒØªØ¨Ø© reCAPTCHA -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>
<body>
  <div class="pp">
    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø² -->
    <form id="verifyForm" class="card">
      <h2>Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ</h2>
      <input type="email" id="email" placeholder="example@email.com" required>
      <br>

      <!-- âœ… reCAPTCHA Ù‡Ù†Ø§ -->
      <div class="g-recaptcha" data-sitekey="6Ld7vYIrAAAAABfSgPdVQ2PwedGqjIq1MAmnh9oK"></div>
      <br>

      <button type="submit">Ø£Ø±Ø³Ù„ Ø§Ù„Ø±Ù…Ø²</button>
    </form>

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù…Ø² -->
    <form id="checkForm" class="card">
      <h2>Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚</h2>
      <input type="text" id="code" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ù‡Ù†Ø§" required>
      <br>
      <button type="submit">ØªØ­Ù‚Ù‚</button>
    </form>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // âœ… Ù…ÙØªØ§Ø­ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† EmailJS
      emailjs.init("X6Jqjy6CmWHmL8VTr");

      // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø²
      document.getElementById('verifyForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const recaptchaToken = grecaptcha.getResponse();
        if (!recaptchaToken) {
          alert("ÙŠØ±Ø¬Ù‰ ØªØ£ÙƒÙŠØ¯ Ø£Ù†Ùƒ Ù„Ø³Øª Ø±ÙˆØ¨ÙˆØª ğŸ¤–");
          return;
        }

        const email = document.getElementById('email').value;
        const code = Math.floor(100000 + Math.random() * 900000); // Ø±Ù…Ø² Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù…
        localStorage.setItem("verificationCode", code);

        emailjs.send("service_j7ko65b", "template_q8r1wqg", {
          to_email: email,
          message: `Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù‡Ùˆ: ${code}`,
          "g-recaptcha-response": recaptchaToken
        }).then(() => {
          alert("ğŸ“§ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø² Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ!");
          grecaptcha.reset(); // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ reCAPTCHA
        }, (err) => {
          alert("âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: " + JSON.stringify(err));
        });
      });

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ù…Ø¯Ø®Ù„
      document.getElementById('checkForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const enteredCode = document.getElementById('code').value;
        const realCode = localStorage.getItem("verificationCode");

        if (enteredCode === realCode) {
          alert("âœ… ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ù†Ø¬Ø§Ø­!");
          window.location.href = "https://achrafmeh.github.io/games/"; // ØªÙˆØ¬ÙŠÙ‡ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚
        } else {
          alert("âŒ Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­!");
        }
      });
    });
  </script>
</body>
</html>
